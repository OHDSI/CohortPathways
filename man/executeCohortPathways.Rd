% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/ExecuteCohortPathways.R
\name{executeCohortPathways}
\alias{executeCohortPathways}
\title{Execute cohort pathway analysis.}
\usage{
executeCohortPathways(
  connectionDetails = NULL,
  connection = NULL,
  cohortDatabaseSchema,
  cohortTableName = "cohort",
  tempEmulationSchema = getOption("sqlRenderTempEmulationSchema"),
  targetCohortIds,
  eventCohortIds,
  minCellCount = 5,
  allowRepeats = FALSE,
  maxDepth = 5,
  collapseWindow = 30
)
}
\arguments{
\item{connectionDetails}{An object of type \code{\link[DatabaseConnector]{createConnectionDetails}}
(from the \pkg{DatabaseConnector} package) providing the details
to connect to the database. If \code{NULL}, then \code{connection}
must be provided.}

\item{connection}{An existing database connection (as created by
\code{\link[DatabaseConnector]{connect}}). If \code{NULL}, a new
connection will be established using \code{connectionDetails} at
the start of the function, and closed upon completion.}

\item{cohortDatabaseSchema}{Schema where the target and event cohorts are stored.
For SQL Server, this should include both the database and
schema name (e.g., "mydatabase.dbo").}

\item{cohortTableName}{Name of the table containing your cohorts (default = "cohort").}

\item{tempEmulationSchema}{For databases without true temp table support (e.g., Oracle),
specify a schema where you have write privileges to emulate temp
tables.}

\item{targetCohortIds}{Integer vector of cohort definition IDs representing one or more
\emph{target} cohorts (the index populations whose pathways you want
to explore).}

\item{eventCohortIds}{Integer vector of cohort definition IDs representing one or more
\emph{event} cohorts (the steps in the pathways, e.g., treatments or
clinical events).}

\item{minCellCount}{The minimum cell count to display (default = 5). Any group or count
below this threshold should be redacted or masked if you're following
a strict privacy policy.}

\item{allowRepeats}{Boolean; if \code{TRUE}, an event cohort can reappear multiple times
in the same patient's pathway sequence (default = \code{FALSE}).}

\item{maxDepth}{Maximum number of steps in any pathway (default = 5). Pathways
longer than this threshold are truncated.}

\item{collapseWindow}{An integer indicating the number of days within which events are
considered the same "step" (default = 30 days). This window
effectively groups closely occurring events to reduce spurious
variability.}
}
\value{
A named list of data frames capturing key pathway results:
\describe{
\item{\code{pathwayAnalysisStatsData}}{High-level summary statistics about the
number of people in each target cohort
and the distribution of events.}
\item{\code{pathwaysAnalysisPathsData}}{Rows describing each distinct pathway
(sequence of events) observed,
along with counts of persons following each path.}
\item{\code{pathwaysAnalysisEventsData}}{Detailed event-level information, allowing
you to see how each event fits into a given path.}
\item{\code{pathwayAnalysisCodesData}}{Mapping of event cohort IDs to pathway "codes"
for easy interpretation of combinatorial steps.}
\item{\code{pathwaycomboIds, pathwayAnalysisCodesLong, isCombo}}{Additional helper
tables describing
combos of events.}
}
}
\description{
This function reproduces the logic behind "Cohort Pathways" (sometimes referred to as
"Treatment Pathways") as defined in ATLAS. A \emph{pathway} is the sequence of events that occur
after a cohort entry, often used to compare or visualize patients' treatment patterns.
The function takes a set of target cohorts (the index cohorts) and event cohorts (the
“steps” in the pathway) and computes the frequency and order in which these events occur.
}
\details{
\strong{Overview}
Cohort Pathways are commonly used to visualize how patients move through different treatments
or events over time. Within ATLAS, these pathways are depicted as “sunburst” diagrams and
flow charts. This function provides a programmatic way to replicate that logic outside of ATLAS,
especially useful when you need to run a pathway analysis in a fully scripted R environment.

\strong{Key Steps}
\enumerate{
\item \strong{Identify Cohorts}: You must already have \emph{target} and \emph{event} cohorts instantiated in
your results schema (i.e., the cohorts exist in the \code{cohortTableName} table).
\item \strong{Specify Pathway Parameters}: Options such as \code{allowRepeats}, \code{collapseWindow},
and \code{maxDepth} control how the event sequences are aggregated:
\itemize{
\item \code{allowRepeats}: If \code{TRUE}, an event cohort can appear more than once at
different time points in the pathway sequence for the same person.
\item \code{collapseWindow}: Events that occur within this many days of each other
(default = 30 days) will be considered part of the same step, reducing the “noise” of very
frequent transitions.
\item \code{maxDepth}: The maximum length of a pathway (default = 5 steps). Longer
sequences are truncated to keep the analysis and visualization more interpretable.
}
\item \strong{Analyze}: The function creates internal temporary tables (or uses your specified
\code{tempEmulationSchema} if necessary) to calculate how many people experience
each distinct pathway. It then returns several data frames capturing:
\itemize{
\item \code{pathwayAnalysisStatsData}: Summary statistics by target cohort, including
total counts and the distribution of event occurrences.
\item \code{pathwaysAnalysisPathsData}: The distinct sequences (paths) observed,
with counts of how many persons followed each sequence.
\item \code{pathwaysAnalysisEventsData}: A more granular breakdown of how events
contribute to different pathway steps.
\item \code{pathwayAnalysisCodesData} and related tables: Helper mappings and indices
that translate event cohorts into pathway “codes.”
}
}

\strong{Cell Count Restrictions}
The argument \code{minCellCount} allows you to enforce a minimum cell count, consistent with
privacy rules. Any group or count below \code{minCellCount} can be masked or handled downstream
according to your organization’s policies.

\strong{Reference}
\itemize{
\item \emph{The Book of OHDSI} (Chapter: Characterization, Section: Cohort Pathways in ATLAS)
\item OHDSI Forums:
\url{https://forums.ohdsi.org/t/cohort-pathways-in-atlas-faq/9511/2}
\url{https://forums.ohdsi.org/t/reproducing-a-treatment-pathway-study-atlas-json-files/9450}
}
}
\examples{
\dontrun{
# Example: Execute a pathway analysis for two target cohorts and three event cohorts.

# 1) Create connection details or use an existing connection.
connDetails <- DatabaseConnector::createConnectionDetails(
  dbms = "postgresql",
  server = "myserver/mydb",
  user = "someuser",
  password = "DontSharePasswords"
)

# 2) Run the function
result <- executeCohortPathways(
  connectionDetails = connDetails,
  cohortDatabaseSchema = "my_results_schema",
  cohortTableName = "my_cohort",
  targetCohortIds = c(123, 456), # e.g., 'diabetes' and 'hypertension' cohorts
  eventCohortIds = c(789, 1011, 1213), # e.g., 'metformin', 'insulin', 'ace_inhibitors'
  allowRepeats = TRUE,
  maxDepth = 4,
  collapseWindow = 14
)

# 3) Inspect the returned data frames for pathway summaries and details
names(result)
head(result$pathwaysAnalysisPathsData)
}

}
